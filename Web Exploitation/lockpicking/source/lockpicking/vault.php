<?php
session_start();
if (!isset($_SESSION['loggedin'])) {
    die("You must log in first!");
}

require 'db.php';


$blacklist = ['or', 'and', 'union', 'select', 'from', 'where', 'information_schema', '--', '#'];

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $code = $_POST['code'];

    foreach ($blacklist as $bad) {
        if (stripos($code, $bad) !== false) {
            $error = "Blocked keyword detected: $bad";
            break;
        }
    }

    if (!isset($error)) {
        $query = "SELECT contents FROM vault WHERE code = '$code'";
        $result = mysqli_query($conn, $query);

        if ($result && mysqli_num_rows($result) > 0) {
            $row = mysqli_fetch_assoc($result);
            $success = "Vault opened!";
            $contents = $row['contents'];
        } else {
            $error = "Invalid vault code.";
        }
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>The Vault</title>
</head>
<body style="background-color:#1c3669; display:flex; align-items:center; justify-content:center; height:100vh;">
    <div style="background:#0e1f3d; padding:2rem; border-radius:12px; box-shadow:0 0 20px rgba(0,0,0,0.5); width:420px; text-align:center;">
        <div style="font-size:48px; margin-bottom:1rem;">ðŸ’°</div>
        <h2 style="color:#3aa6ff; margin-bottom:0.5rem;">The Vault</h2>
        <p style="color:#ccc; font-size:14px;">A digital keypad awaits you. But beware, it blocks some obvious tricks:</p>
        <div style="background:#162a52; padding:0.7rem; border-radius:6px; font-size:13px; color:#ddd; margin-bottom:1rem;">
            <?php echo htmlspecialchars(implode(', ', $blacklist)); ?>
        </div>

        <?php if (isset($error)) echo "<p style='color:#ff7b7b; margin-top:1rem;'>$error</p>"; ?>
        <?php if (isset($success)) echo "<p style='color:#7bff7b; margin-top:1rem;'>$success</p><pre style='background:#162a52; padding:1rem; border-radius:6px; color:#fff; margin-top:1rem;'>".htmlspecialchars($contents)."</pre>"; ?>

        <form method="post" action="">
            <div style="margin:1rem 0; text-align:left;">
                <label style="color:#fff;">Vault Code:</label>
                <input type="text" name="code" style="width:100%; padding:0.5rem; border-radius:6px; border:none; margin-top:6px;">
            </div>
            <button type="submit" style="width:100%; padding:0.7rem; background:#3aa6ff; border:none; border-radius:6px; color:#fff; font-weight:bold; cursor:pointer;">
                ðŸ”“ Unlock the Vault
            </button>
        </form>

        <p style="margin-top:1.5rem;"><a href="logout.php" style="color:#66aaff; text-decoration:none;">ðŸšª Exit (Logout)</a></p>
    </div>
</body>
</html>
