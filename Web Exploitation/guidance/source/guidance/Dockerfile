FROM golang:1.21-alpine AS builder
WORKDIR /app

COPY . .


RUN CGO_ENABLED=0 GOOS=linux go build -ldflags="-s -w" -o /guidance ./main.go



FROM alpine:3.18
# Install necessary packages
RUN apk add --no-cache bash su-exec

RUN addgroup -S app && adduser -S -G app app

WORKDIR /app

COPY --from=builder /guidance /app/guidance
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

COPY public/ /app/
EXPOSE 80

CMD ["/entrypoint.sh"]