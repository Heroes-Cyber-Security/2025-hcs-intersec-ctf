FROM golang:1.21-alpine AS builder
WORKDIR /app

COPY . .


RUN CGO_ENABLED=0 GOOS=linux go build -ldflags="-s -w" -o /guidance ./main.go



FROM alpine:3.18
RUN addgroup -S app && adduser -S -G app app

WORKDIR /app


COPY --from=builder /guidance /app/guidance


COPY public/ /app/
COPY flag.txt /flag.txt
RUN chmod 644 /flag.txt

EXPOSE 80
USER app


CMD ["/app/guidance"]