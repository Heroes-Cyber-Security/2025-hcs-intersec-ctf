FROM ubuntu:22.04
ENV DEBIAN_FRONTEND=noninteractive

# Install necessary packages for building and running the application
RUN apt-get update -y && \
    apt-get install -y socat build-essential gcc-multilib && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Create a non-root user
RUN useradd -u 1000 -d /home/user -s /bin/bash user

# Set the working directory
WORKDIR /home/user

# Copy the binary
COPY entrypoint.sh /entrypoint.sh
COPY chall /home/user/

# Set permissions to make necessary files read-only
RUN chmod +x /entrypoint.sh
RUN chmod 111 /home/user/chall
RUN chmod -R 555 /home/user

# Expose port
EXPOSE 1337
CMD ["/entrypoint.sh"]
